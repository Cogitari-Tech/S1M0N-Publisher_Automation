services:
  # Serviço Principal - Content Robot (Main Engine)
  robot:
    build: .
    container_name: s1m0n-robot
    restart: unless-stopped
    volumes:
      - ./:/app
      - robot-data:/app/data
    environment:
      # Sistema
      - DOCKER_ENV=development
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-change-me-in-production}
      - DATABASE_URI=sqlite:////app/data/content_robot.db
      
      # Automação
      - MAX_ARTICLES_PER_CYCLE=${MAX_ARTICLES_PER_CYCLE:-5}
      - REQUIRE_MANUAL_APPROVAL=${REQUIRE_MANUAL_APPROVAL:-True}
      
      # Google Cloud / AI
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID}
      - GOOGLE_LOCATION=${GOOGLE_LOCATION:-us-central1}
      - AI_MODEL_TYPE=${AI_MODEL_TYPE:-pro}
      - YOUTUBE_API_KEY=${YOUTUBE_API_KEY}
      
      # Provedores de Notícias
      - NEWSAPI_KEY=${NEWSAPI_KEY}
      - CURRENTS_API_KEY=${CURRENTS_API_KEY}
      - GNEWS_API_KEY=${GNEWS_API_KEY}
      
      # WordPress (Publicação)
      - WORDPRESS_URL=${WORDPRESS_URL}
      - WORDPRESS_USERNAME=${WORDPRESS_USERNAME}
      - WORDPRESS_PASSWORD=${WORDPRESS_PASSWORD}
    command: python main.py
    networks:
      - s1m0n-network
    healthcheck:
      test: ["CMD", "python", "-c", "import sqlite3; conn = sqlite3.connect('/app/data/content_robot.db'); conn.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Dashboard Web Interface
  dashboard:
    build: .
    container_name: s1m0n-dashboard
    restart: unless-stopped
    ports:
      - "${DASHBOARD_PORT:-5000}:5000"
    volumes:
      - ./:/app
      - robot-data:/app/data
    environment:
      # Sistema
      - DOCKER_ENV=development
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-change-me-in-production}
      - DATABASE_URI=sqlite:////app/data/content_robot.db
      
      # Google Cloud / AI (necessário para visualizar estatísticas)
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID}
      
      # WordPress (para links de publicação)
      - WORDPRESS_URL=${WORDPRESS_URL}
    command: python dashboard_launcher.py
    networks:
      - s1m0n-network
    depends_on:
      - robot
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

networks:
  s1m0n-network:
    driver: bridge

volumes:
  robot-data:
    driver: local
